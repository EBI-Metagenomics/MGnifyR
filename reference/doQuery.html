<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Search MGnify database for studies, samples and runs — doQuery • MGnifyR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Search MGnify database for studies, samples and runs — doQuery"><meta property="og:description" content="Search MGnify database for studies, samples and runs"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MGnifyR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.99.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/MGnifyR_long.html">MGnifyR: interface to MGnify database</a>
    </li>
    <li>
      <a href="../articles/MgnifyR.html">MGnifyR: interface to MGnify database</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/EBI-Metagenomics/MGnifyR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Search MGnify database for studies, samples and runs</h1>
    <small class="dont-index">Source: <a href="https://github.com/EBI-Metagenomics/MGnifyR/blob/HEAD/R/allGenerics.R" class="external-link"><code>R/allGenerics.R</code></a>, <a href="https://github.com/EBI-Metagenomics/MGnifyR/blob/HEAD/R/doQuery.R" class="external-link"><code>R/doQuery.R</code></a></small>
    <div class="hidden name"><code>doQuery.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Search MGnify database for studies, samples and runs</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">doQuery</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for MgnifyClient</span></span>
<span><span class="fu">doQuery</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"studies"</span>, <span class="st">"samples"</span>, <span class="st">"runs"</span>, <span class="st">"analyses"</span><span class="op">)</span>,</span>
<span>  accession <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  as.df <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  max.hits <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  use.cache <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>A <code>MgnifyClient</code> object.</p></dd>


<dt>...</dt>
<dd><p>Remaining parameter key/value pairs may be supplied to filter
the returned values. Available options differ between <code>types</code>.
See discussion above for details.</p></dd>


<dt>type</dt>
<dd><p>A single character value specifying the type of objects to
query. Must be one of the following options: <code>studies</code>, <code>samples</code>,
<code>runs</code> or <code>analyses</code>. (By default: <code>type = "studies"</code>)</p></dd>


<dt>accession</dt>
<dd><p>A single character value or a vector of character values
specifying MGnify accession identifiers (of type <code>type</code>) or NULL. When
NULL, all results defined by other parameters are retrieved.
(By default: <code>accession = NULL</code>)</p></dd>


<dt>as.df</dt>
<dd><p>A single boolean value specifying whether to return the
results as a data.frame or leave as a nested list. In most cases,
<code>as.df = TRUE</code> will make the most sense.
(By default: <code>as.df = TRUE</code>)</p></dd>


<dt>max.hits</dt>
<dd><p>A single integer value specifying the maximum number of
results to return or FALSE. The actual number of results will actually be
higher than <code>max.hits</code>, as clipping only occurs on pagination page
boundaries. To disable the limit, set <code>max.hits = NULL</code>.
(By default: <code>max.hits = 200</code>)</p></dd>


<dt>use.cache</dt>
<dd><p>A single boolean value specifying whether to cache the
result -- and reuse any existing cache entry instead of issuing a new
callout. In general the use of caching for queries is discouraged, as
new data is being uploaded to MGnify all the time, which might potentially
be missed. However, for some purposes (such as analysis reproducibility)
caching makes sense. (By default: <code>use.cache = FALSE</code>)</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A nested list or data.frame containing the results of the query.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p><code>doQuery</code> is a flexible query function, harnessing the "full"
power of the JSONAPI MGnify search filters. Search results may be filtered
by metadata value, associated study/sample/analyese etc. Details of the
capabilities may be found
[here](https://emg-docs.readthedocs.io/en/latest/api.html#customising-queries).
Currently, the following filters are available (based on examination of the
Python source code):</p><ul><li><p><strong>studies</strong>: accession, biome_name, lineage, centre_name</p></li>
<li><p><strong>samples</strong>: accession, experiment_type, biome_name,
            lineage, geo_loc_name, latitude_gte, latitude_lte,
            longitude_gte, longitude_lte, species, instrument_model,
            instrument_platform, metadata_key, metadata_value_gte,
            metadata_value_lte, metadata_value, environment_material,
            environment_feature, study_accession</p></li>
<li><p><strong>runs</strong>: accession, experiment_type, biome_name, lineage,
           species, instrument_platform, instrument_model</p></li>
</ul><p>Unfortunately it appears that in some cases, some of these filters don't work
as expected, so it is important to check the results returned match up with
what's expected. Even more unfortunately if there's an error in the parameter
specification, the query will run as if no filter parameters were present
at all. Thus the result will appear superficially correct but will infact
correspond to something completely different. This behaviour will hopefully
be fixed in future incarnations of the MGnifyR or JSONAPI, but for now users
should double check returned values.</p>
<p>It is currently not possible to combine queries of the same type in a single
call (for example to search for samples <em>between</em> latitude). However,
it is possible to run multiple queries and combine the results using set
operations in R to get the desired behaviour.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">mg</span> <span class="op">&lt;-</span> <span class="fu"><a href="MgnifyClient.html">MgnifyClient</a></span><span class="op">(</span>cache_dir<span class="op">=</span><span class="st">"/tmp/mgcache"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get a list of studies from the Agricultural Wastewater :</span></span></span>
<span class="r-in"><span><span class="va">agwaste_studies</span> <span class="op">&lt;-</span> <span class="fu">doQuery</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">mg</span>, <span class="st">"studies"</span>, biome_name<span class="op">=</span><span class="st">"Agricultural wastewater"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get all samples from a particular study</span></span></span>
<span class="r-in"><span><span class="va">samps</span> <span class="op">&lt;-</span> <span class="fu">doQuery</span><span class="op">(</span><span class="va">mg</span>, <span class="st">"samples"</span>, study_accession<span class="op">=</span><span class="st">"MGYS00004521"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Search polar samples</span></span></span>
<span class="r-in"><span><span class="va">samps_np</span> <span class="op">&lt;-</span> <span class="fu">doQuery</span><span class="op">(</span><span class="va">mg</span>, <span class="st">"samples"</span>, latitude_gte<span class="op">=</span><span class="fl">66</span>, max.hits<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samps_sp</span> <span class="op">&lt;-</span> <span class="fu">doQuery</span><span class="op">(</span><span class="va">mg</span>, <span class="st">"samples"</span>, latitude_lte<span class="op">=</span><span class="op">-</span><span class="fl">66</span>, max.hits<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Search studies that have studied drinking water</span></span></span>
<span class="r-in"><span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu">doQuery</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">mg</span>,</span></span>
<span class="r-in"><span>    type <span class="op">=</span> <span class="st">"studies"</span>,</span></span>
<span class="r-in"><span>    biome_name <span class="op">=</span> <span class="st">"root:Environmental:Aquatic:Freshwater:Drinking water"</span>,</span></span>
<span class="r-in"><span>    max.hits <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Tuomas Borman, Ben Allen, Leo Lahti.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

